<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Content Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold">Admin Panel</h1>
        </div>

        <!-- Status Message -->
        <div id="status-message" class="mb-6 p-4 rounded-md bg-blue-50 border border-blue-200">
            <p class="text-blue-800">Loading content...</p>
        </div>

        <!-- General Images Management -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold mb-6 border-b pb-2">Manage General Images</h2>
            <div id="images-container" class="space-y-8">
                <!-- Images will be loaded here -->
            </div>
            <button id="add-image-btn" class="mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600">
                Add New Image
            </button>
        </div>

        <!-- Accommodations Management -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold mb-6 border-b pb-2">Manage Accommodations</h2>
            <div id="accommodation-container" class="space-y-8">
                <!-- Accommodations will be loaded here -->
            </div>
            <button id="add-accommodation-btn" class="mt-6 bg-purple-500 text-white px-6 py-2 rounded-md hover:bg-purple-600">
                Add New Accommodation
            </button>
        </div>

        <!-- Buttons Management -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold mb-6 border-b pb-2">Manage Buttons</h2>
            <div id="buttons-container" class="space-y-8">
                <!-- Buttons will be loaded here -->
            </div>
            <button id="add-button-btn" class="mt-6 bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600">
                Add New Button
            </button>
        </div>

        <!-- Save All Button -->
        <div class="mt-12 text-center">
            <button id="save-all-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-lg">
                Save All Changes
            </button>
        </div>
    </div>

    <script>
        // Global content data
        let contentData = {};

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                showStatus('Loading content...', 'info');
                await loadContentFromJSON();
                renderAllSections();
                setupEventListeners();
                showStatus('Content loaded successfully!', 'success');
            } catch (error) {
                console.error('Error:', error);
                showStatus('Failed to load content. Using empty data.', 'error');
                initializeEmptyContent();
                renderAllSections();
                setupEventListeners();
            }
        });

        // Load content from JSON file
        async function loadContentFromJSON() {
            const response = await fetch('./content.json');
            if (!response.ok) {
                throw new Error('Failed to load content.json');
            }
            contentData = await response.json();
        }

        // Initialize empty content
        function initializeEmptyContent() {
            contentData = {
                images: [],
                accommodations: [],
                buttons: []
            };
        }

        // Show status message
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            const colors = {
                info: 'bg-blue-50 border-blue-200 text-blue-800',
                success: 'bg-green-50 border-green-200 text-green-800',
                error: 'bg-red-50 border-red-200 text-red-800'
            };
            statusEl.className = `mb-6 p-4 rounded-md border ${colors[type] || colors.info}`;
            statusEl.innerHTML = `<p>${message}</p>`;
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('add-image-btn')?.addEventListener('click', addNewImage);
            document.getElementById('add-accommodation-btn')?.addEventListener('click', addNewAccommodation);
            document.getElementById('add-button-btn')?.addEventListener('click', addNewButton);
            document.getElementById('save-all-btn')?.addEventListener('click', saveContent);
        }

        // Render all sections
        function renderAllSections() {
            renderImages();
            renderAccommodations();
            renderButtons();
        }

        // Render images
        function renderImages() {
            const container = document.getElementById('images-container');
            if (!container) return;

            if (contentData.images && contentData.images.length > 0) {
                container.innerHTML = contentData.images.map((image, index) => `
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="text-lg font-semibold mb-4">Image ${index + 1}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Image ID</label>
                                <input type="text" value="${image.id || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateImage(${index}, 'id', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Image Source</label>
                                <input type="text" value="${image.src || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateImage(${index}, 'src', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Alt Text</label>
                                <input type="text" value="${image.alt || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateImage(${index}, 'alt', this.value)">
                            </div>
                            <div class="flex items-end">
                                <button onclick="removeImage(${index})" 
                                        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                    Remove
                                </button>
                            </div>
                        </div>
                        ${image.src ? `<div class="mt-4"><img src="${image.src}" alt="${image.alt}" class="max-w-xs max-h-32 object-cover rounded"></div>` : ''}
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No images found. Click "Add New Image" to get started.</p>';
            }
        }

        // Render accommodations
        function renderAccommodations() {
            const container = document.getElementById('accommodation-container');
            if (!container) return;

            if (contentData.accommodations && contentData.accommodations.length > 0) {
                container.innerHTML = contentData.accommodations.map((acc, index) => `
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="text-lg font-semibold mb-4">Accommodation ${index + 1}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Title</label>
                                <input type="text" value="${acc.title || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateAccommodation(${index}, 'title', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Image Source</label>
                                <input type="text" value="${acc.imageSrc || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateAccommodation(${index}, 'imageSrc', this.value)">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Description</label>
                                <textarea class="w-full p-2 border rounded-md" rows="3" 
                                          onchange="updateAccommodation(${index}, 'description', this.value)">${acc.description || ''}</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Button Text</label>
                                <input type="text" value="${acc.buttonText || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateAccommodation(${index}, 'buttonText', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Button Link</label>
                                <input type="text" value="${acc.buttonLink || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateAccommodation(${index}, 'buttonLink', this.value)">
                            </div>
                            <div class="md:col-span-2">
                                <button onclick="removeAccommodation(${index})" 
                                        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                    Remove
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No accommodations found. Click "Add New Accommodation" to get started.</p>';
            }
        }

        // Render buttons
        function renderButtons() {
            const container = document.getElementById('buttons-container');
            if (!container) return;

            if (contentData.buttons && contentData.buttons.length > 0) {
                container.innerHTML = contentData.buttons.map((button, index) => `
                    <div class="bg-white p-6 rounded-lg shadow-md border">
                        <h3 class="text-lg font-semibold mb-4">Button ${index + 1}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Button ID</label>
                                <input type="text" value="${button.id || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateButton(${index}, 'id', this.value)">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Button Text</label>
                                <input type="text" value="${button.text || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateButton(${index}, 'text', this.value)">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium mb-2">Button Link</label>
                                <input type="text" value="${button.link || ''}" 
                                       class="w-full p-2 border rounded-md" 
                                       onchange="updateButton(${index}, 'link', this.value)">
                            </div>
                            <div class="md:col-span-2">
                                <button onclick="removeButton(${index})" 
                                        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                    Remove
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500">No buttons found. Click "Add New Button" to get started.</p>';
            }
        }

        // Add functions
        function addNewImage() {
            if (!contentData.images) contentData.images = [];
            contentData.images.push({
                id: `image-${Date.now()}`,
                src: '',
                alt: ''
            });
            renderImages();
        }

        function addNewAccommodation() {
            if (!contentData.accommodations) contentData.accommodations = [];
            contentData.accommodations.push({
                id: `accommodation-${Date.now()}`,
                title: 'New Accommodation',
                imageSrc: '',
                description: '',
                buttonText: 'Book Now',
                buttonLink: '#'
            });
            renderAccommodations();
        }

        function addNewButton() {
            if (!contentData.buttons) contentData.buttons = [];
            contentData.buttons.push({
                id: `button-${Date.now()}`,
                text: 'New Button',
                link: '#'
            });
            renderButtons();
        }

        // Update functions
        function updateImage(index, field, value) {
            if (contentData.images && contentData.images[index]) {
                contentData.images[index][field] = value;
            }
        }

        function updateAccommodation(index, field, value) {
            if (contentData.accommodations && contentData.accommodations[index]) {
                contentData.accommodations[index][field] = value;
            }
        }

        function updateButton(index, field, value) {
            if (contentData.buttons && contentData.buttons[index]) {
                contentData.buttons[index][field] = value;
            }
        }

        // Remove functions
        function removeImage(index) {
            if (contentData.images && confirm('Remove this image?')) {
                contentData.images.splice(index, 1);
                renderImages();
            }
        }

        function removeAccommodation(index) {
            if (contentData.accommodations && confirm('Remove this accommodation?')) {
                contentData.accommodations.splice(index, 1);
                renderAccommodations();
            }
        }

        function removeButton(index) {
            if (contentData.buttons && confirm('Remove this button?')) {
                contentData.buttons.splice(index, 1);
                renderButtons();
            }
        }

        // Save content
        function saveContent() {
            const jsonString = JSON.stringify(contentData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'content.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('Content saved! Download complete - replace your content.json file.', 'success');
        }
    </script>
</body>
</html>